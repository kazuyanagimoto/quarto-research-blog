{
  "hash": "736eb2183963c7c4a3b45859f608f616",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Madrid Traffic Accidents Dataset\nauthor: Kazuharu Yanagimoto\ndate: 2024-03-24\ncategories: [descriptive, traffic accidents]\n---\n\n\n\n\nThis is an analysis of the Madrid Traffic Accidents [dataset](https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=7c2843010d9c3610VgnVCM2000001f4a900aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default).\nYou can find a code for downloading and cleaning the data in\n`code/00_download/` and `code/01_cleaning/`.\n\n::: {.callout-note}\n\nI wrote this code for the workshop \"An Advanced Introduction to R\"\nat CEMFI in January 2022. You can find the slides and the materials in the \n[GitHub repository](https://github.com/kazuyanagimoto/workshop-r-2022)\n\n:::\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\naccident_bike |>\n  ggplot(aes(\n    x = forcats::fct_rev(type_person),\n    fill = forcats::fct_rev(gender)\n  )) +\n  geom_bar(position = \"dodge\") +\n  coord_flip() +\n  scale_fill_gender() +\n  labs(x = NULL, y = NULL, fill = NULL, title = \"Number of Accidents\") +\n  theme(legend.position = c(0.85, 0.1), panel.grid.major.y = element_blank()) +\n  guides(fill = guide_legend(reverse = TRUE))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/figure-num-accidents-1.svg){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## Logit Regression of Hospitalization and Death\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodels <- list(\n  \"(1)\" = feglm(\n    is_hospitalized ~\n      type_person + positive_alcohol + positive_drug | age_c + gender,\n    family = binomial(logit),\n    data = accident_bike\n  ),\n  \"(2)\" = feglm(\n    is_hospitalized ~\n      type_person +\n        positive_alcohol +\n        positive_drug |\n        age_c + gender + type_vehicle,\n    family = binomial(logit),\n    data = accident_bike\n  ),\n  \"(3)\" = feglm(\n    is_hospitalized ~\n      type_person +\n        positive_alcohol +\n        positive_drug |\n        age_c + gender + type_vehicle + weather,\n    family = binomial(logit),\n    data = accident_bike\n  ),\n  \"(4)\" = feglm(\n    is_died ~ type_person + positive_alcohol + positive_drug | age_c + gender,\n    family = binomial(logit),\n    data = accident_bike\n  ),\n  \"(5)\" = feglm(\n    is_died ~\n      type_person +\n        positive_alcohol +\n        positive_drug |\n        age_c + gender + type_vehicle,\n    family = binomial(logit),\n    data = accident_bike\n  ),\n  \"(6)\" = feglm(\n    is_died ~\n      type_person +\n        positive_alcohol +\n        positive_drug |\n        age_c + gender + type_vehicle + weather,\n    family = binomial(logit),\n    data = accident_bike\n  )\n)\n\ncm <- c(\n  \"type_personPassenger\" = \"Passenger\",\n  \"type_personPedestrian\" = \"Pedestrian\",\n  \"positive_alcoholTRUE\" = \"Positive Alcohol\"\n)\n\ngm <- tibble(\n  raw = c(\"nobs\", \"FE: age_c\", \"FE: gender\", \"FE: type_vehicle\", \"FE: weather\"),\n  clean = c(\n    \"Observations\",\n    \"FE: Age Group\",\n    \"FE: Gender\",\n    \"FE: Type of Vehicle\",\n    \"FE: Weather\"\n  ),\n  fmt = c(0, 0, 0, 0, 0)\n)\n\nmodelsummary(\n  models,\n  stars = c(\"+\" = .1, \"*\" = .05, \"**\" = .01),\n  coef_map = cm,\n  gof_map = gm\n) |>\n  group_tt(j = list(\"Hospitalization\" = 2:4, \"Died within 24 hours\" = 5:7))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_st362su6taivhc7zj8z3(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_st362su6taivhc7zj8z3\");\n          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_st362su6taivhc7zj8z3');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_st362su6taivhc7zj8z3(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_st362su6taivhc7zj8z3\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: 7, j: 0 },  ], css_id: 'tinytable_css_uopxs8x583o3299b5k2l',}, \n          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_r6zdquju4onak50x7fcn',}, \n          { positions: [ { i: 7, j: 2 }, { i: 7, j: 1 }, { i: 7, j: 6 }, { i: 7, j: 3 }, { i: 7, j: 4 }, { i: 7, j: 5 },  ], css_id: 'tinytable_css_mhxt5hnxg9tpn2ks4cjg',}, \n          { positions: [ { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 2, j: 1 }, { i: 11, j: 1 }, { i: 8, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 9, j: 1 }, { i: 10, j: 1 }, { i: 6, j: 2 }, { i: 11, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 10, j: 2 }, { i: 2, j: 3 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 5, j: 3 }, { i: 6, j: 3 }, { i: 3, j: 3 }, { i: 4, j: 3 }, { i: 9, j: 3 }, { i: 10, j: 3 }, { i: 11, j: 3 }, { i: 8, j: 3 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 }, { i: 6, j: 4 }, { i: 11, j: 4 }, { i: 3, j: 5 }, { i: 4, j: 5 }, { i: 10, j: 4 }, { i: 2, j: 5 }, { i: 11, j: 5 }, { i: 8, j: 5 }, { i: 5, j: 5 }, { i: 6, j: 5 }, { i: 2, j: 6 }, { i: 3, j: 6 }, { i: 9, j: 5 }, { i: 10, j: 5 }, { i: 6, j: 6 }, { i: 11, j: 6 }, { i: 4, j: 6 }, { i: 5, j: 6 }, { i: 10, j: 6 }, { i: 8, j: 6 }, { i: 9, j: 6 },  ], css_id: 'tinytable_css_fcqsunb7zl2kvw52qoos',}, \n          { positions: [ { i: 1, j: 0 },  ], css_id: 'tinytable_css_eege9wj7otw4t7oqadiq',}, \n          { positions: [ { i: 12, j: 1 }, { i: 12, j: 2 }, { i: 12, j: 3 }, { i: 12, j: 4 }, { i: 12, j: 5 }, { i: 12, j: 6 },  ], css_id: 'tinytable_css_9yvfayh8e0gs3oa48bh4',}, \n          { positions: [ { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 11, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 10, j: 0 },  ], css_id: 'tinytable_css_9ixw1n6mesmxqzpeqq7q',}, \n          { positions: [ { i: 0, j: 2 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_8oenaoj5ri9300hj9r7d',}, \n          { positions: [ { i: 1, j: 1 }, { i: 1, j: 2 }, { i: 1, j: 3 }, { i: 1, j: 4 }, { i: 1, j: 5 }, { i: 1, j: 6 },  ], css_id: 'tinytable_css_6oqe1lfj4c6yfhhcog3z',}, \n          { positions: [ { i: 0, j: 6 }, { i: 0, j: 3 }, { i: 0, j: 4 }, { i: 0, j: 5 },  ], css_id: 'tinytable_css_20rcutal09irbjwkrspv',}, \n          { positions: [ { i: 12, j: 0 },  ], css_id: 'tinytable_css_14dwqk8iuitpims1hpsm',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_st362su6taivhc7zj8z3(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_uopxs8x583o3299b5k2l, .table th.tinytable_css_uopxs8x583o3299b5k2l { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_r6zdquju4onak50x7fcn, .table th.tinytable_css_r6zdquju4onak50x7fcn { text-align: left; border-top: solid #d3d8dc 0.1em; text-align: center; }\n      .table td.tinytable_css_mhxt5hnxg9tpn2ks4cjg, .table th.tinytable_css_mhxt5hnxg9tpn2ks4cjg { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_fcqsunb7zl2kvw52qoos, .table th.tinytable_css_fcqsunb7zl2kvw52qoos { text-align: center; }\n      .table td.tinytable_css_eege9wj7otw4t7oqadiq, .table th.tinytable_css_eege9wj7otw4t7oqadiq { text-align: left; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_9yvfayh8e0gs3oa48bh4, .table th.tinytable_css_9yvfayh8e0gs3oa48bh4 { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_9ixw1n6mesmxqzpeqq7q, .table th.tinytable_css_9ixw1n6mesmxqzpeqq7q { text-align: left; }\n      .table td.tinytable_css_8oenaoj5ri9300hj9r7d, .table th.tinytable_css_8oenaoj5ri9300hj9r7d { text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_6oqe1lfj4c6yfhhcog3z, .table th.tinytable_css_6oqe1lfj4c6yfhhcog3z { text-align: center; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_20rcutal09irbjwkrspv, .table th.tinytable_css_20rcutal09irbjwkrspv { text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; }\n      .table td.tinytable_css_14dwqk8iuitpims1hpsm, .table th.tinytable_css_14dwqk8iuitpims1hpsm { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_st362su6taivhc7zj8z3\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n<tr>\n<th scope=\"col\" align=\"center\" colspan=1> </th>\n<th scope=\"col\" align=\"center\" colspan=3>Hospitalization</th>\n<th scope=\"col\" align=\"center\" colspan=3>Died within 24 hours</th>\n</tr>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n                <th scope=\"col\">(2)</th>\n                <th scope=\"col\">(3)</th>\n                <th scope=\"col\">(4)</th>\n                <th scope=\"col\">(5)</th>\n                <th scope=\"col\">(6)</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>+ p < 0.1, * p < 0.05, ** p < 0.01</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td>Passenger</td>\n                  <td>0.026</td>\n                  <td>0.501**</td>\n                  <td>0.475**</td>\n                  <td>-1.697**</td>\n                  <td>-1.445*</td>\n                  <td>-1.440*</td>\n                </tr>\n                <tr>\n                  <td></td>\n                  <td>(0.100)</td>\n                  <td>(0.069)</td>\n                  <td>(0.068)</td>\n                  <td>(0.616)</td>\n                  <td>(0.631)</td>\n                  <td>(0.631)</td>\n                </tr>\n                <tr>\n                  <td>Pedestrian</td>\n                  <td>2.117**</td>\n                  <td>2.381**</td>\n                  <td>2.298**</td>\n                  <td>2.190**</td>\n                  <td>2.326**</td>\n                  <td>2.327**</td>\n                </tr>\n                <tr>\n                  <td></td>\n                  <td>(0.114)</td>\n                  <td>(0.061)</td>\n                  <td>(0.058)</td>\n                  <td>(0.260)</td>\n                  <td>(0.248)</td>\n                  <td>(0.246)</td>\n                </tr>\n                <tr>\n                  <td>Positive Alcohol</td>\n                  <td>0.007</td>\n                  <td>0.355**</td>\n                  <td>0.381**</td>\n                  <td>-13.685**</td>\n                  <td>-13.421**</td>\n                  <td>-13.460**</td>\n                </tr>\n                <tr>\n                  <td></td>\n                  <td>(0.072)</td>\n                  <td>(0.081)</td>\n                  <td>(0.081)</td>\n                  <td>(0.059)</td>\n                  <td>(0.055)</td>\n                  <td>(0.054)</td>\n                </tr>\n                <tr>\n                  <td>Observations</td>\n                  <td>197477</td>\n                  <td>197369</td>\n                  <td>176133</td>\n                  <td>118462</td>\n                  <td>116344</td>\n                  <td>112659</td>\n                </tr>\n                <tr>\n                  <td>FE: Age Group</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                </tr>\n                <tr>\n                  <td>FE: Gender</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td>X</td>\n                </tr>\n                <tr>\n                  <td>FE: Type of Vehicle</td>\n                  <td></td>\n                  <td>X</td>\n                  <td>X</td>\n                  <td></td>\n                  <td>X</td>\n                  <td>X</td>\n                </tr>\n                <tr>\n                  <td>FE: Weather</td>\n                  <td></td>\n                  <td></td>\n                  <td>X</td>\n                  <td></td>\n                  <td></td>\n                  <td>X</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}